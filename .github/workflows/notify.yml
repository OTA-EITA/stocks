name: Slack Notification

on:
  workflow_run:
    workflows: ["Stock Data Pipeline"]
    types: [completed]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Notify Slack on success
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        run: |
          if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            curl -s -X POST ${{ secrets.SLACK_WEBHOOK_URL }} \
              -H 'Content-Type: application/json' \
              -d '{
                "text": "ğŸ“ˆ æ ªä¾¡ãƒ‡ãƒ¼ã‚¿æ›´æ–°å®Œäº†",
                "blocks": [
                  {
                    "type": "section",
                    "text": {
                      "type": "mrkdwn",
                      "text": "*æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Œäº†*\nå®Ÿè¡Œæ™‚åˆ»: `${{ github.event.workflow_run.created_at }}`"
                    }
                  }
                ]
              }'
          else
            echo "No webhook configured"
          fi

      - name: Notify Slack on failure
        if: ${{ github.event.workflow_run.conclusion == 'failure' }}
        run: |
          if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            curl -s -X POST ${{ secrets.SLACK_WEBHOOK_URL }} \
              -H 'Content-Type: application/json' \
              -d '{
                "text": "âš ï¸ æ ªä¾¡ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ",
                "blocks": [
                  {
                    "type": "section",
                    "text": {
                      "type": "mrkdwn",
                      "text": "*ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œå¤±æ•—*\nå®Ÿè¡Œæ™‚åˆ»: `${{ github.event.workflow_run.created_at }}`"
                    }
                  }
                ]
              }'
          fi
